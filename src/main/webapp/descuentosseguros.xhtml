<ui:composition template="/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:define name="content">

        <style>
            body .ui-widget { font-size: 13px !important; }
            body .ui-button { font-size: 13px !important; padding: 0.3rem 0.8rem; }
            .fila-desactivada {
                background-color: #f4f4f4 !important;
                color: #9e9e9e !important;
                font-style: italic;
            }
            .field-label { font-weight: bold; color: #495057; }
        </style>

        <div class="card">
            <h2>Gestión Comercial</h2>

            <p:tabView id="tabViewGeneral">

                <p:tab title="Promociones y Descuentos">
                    <h:form id="frmDescuentos">
                        <p:growl id="msgDescuentos" showDetail="true" life="4000" />

                        <p:toolbar style="margin-bottom: 10px; padding: 5px;">
                            <p:toolbarGroup>
                                <p:commandButton value="Nueva Promoción" icon="pi pi-plus"
                                                 action="#{descuentoBean.newEntity}"
                                                 update=":dialogoDescuento"
                                                 oncomplete="PF('dlgDescuento').show()"
                                                 styleClass="ui-button-success">
                                    <p:resetInput target=":dialogoDescuento" />
                                </p:commandButton>
                            </p:toolbarGroup>
                        </p:toolbar>

                        <p:dataTable id="tblDescuentos" value="#{descuentoBean.list}" var="d"
                                     paginator="true" rows="10" size="small" paginatorPosition="bottom"
                                     rowKey="#{d.id}" selectionMode="single" selection="#{descuentoBean.selected}"
                                     striped="true" rowStyleClass="#{d.estado ? null : 'fila-desactivada'}">

                            <p:column headerText="Nombre" sortBy="#{d.nombrePromocion}">
                                <h:outputText value="#{d.nombrePromocion}" />
                            </p:column>

                            <p:column headerText="Descripción">
                                <h:outputText value="#{d.descripcionPromocion}" />
                            </p:column>

                            <p:column headerText="Valor" width="100" style="text-align: center;">
                                <h:outputText value="#{d.descuentoPromocion}%" style="font-weight:bold"/>
                            </p:column>

                            <p:column headerText="Estado" width="90" style="text-align: center;">
                                <p:tag severity="#{d.estado ? 'success' : 'danger'}" value="#{d.estado ? 'Activo' : 'Inactivo'}"/>
                            </p:column>

                            <p:column headerText="Acciones" width="120" style="text-align: center;">
                                <p:commandButton icon="pi pi-pencil"
                                                 action="#{descuentoBean.edit(d)}"
                                                 update=":dialogoDescuento"
                                                 oncomplete="PF('dlgDescuento').show()"
                                                 styleClass="rounded-button ui-button-flat ui-button-warning"
                                                 disabled="#{!d.estado}">
                                    <p:resetInput target=":dialogoDescuento" />
                                </p:commandButton>

                                <p:commandButton icon="pi pi-ban" rendered="#{d.estado}"
                                                 action="#{descuentoBean.delete(d)}"
                                                 update=":tabViewGeneral:frmDescuentos:tblDescuentos, :tabViewGeneral:frmDescuentos:msgDescuentos"
                                                 styleClass="rounded-button ui-button-flat ui-button-danger">
                                    <p:confirm header="Confirmar" message="¿Desactivar promoción?" icon="pi pi-exclamation-triangle" />
                                </p:commandButton>

                                <p:commandButton icon="pi pi-check-circle" rendered="#{!d.estado}"
                                                 action="#{descuentoBean.activar(d)}"
                                                 update=":tabViewGeneral:frmDescuentos:tblDescuentos, :tabViewGeneral:frmDescuentos:msgDescuentos"
                                                 styleClass="rounded-button ui-button-flat ui-button-success" />
                            </p:column>
                        </p:dataTable>
                    </h:form>
                </p:tab>

                <p:tab title="Aseguradoras">
                    <h:form id="frmSeguros">
                        <p:growl id="msgSeguros" showDetail="true" life="4000" />

                        <p:toolbar style="margin-bottom: 10px; padding: 5px;">
                            <p:toolbarGroup>
                                <p:commandButton value="Nueva Aseguradora" icon="pi pi-plus"
                                                 action="#{seguroBean.newEntity}"
                                                 update=":dialogoSeguro"
                                                 oncomplete="PF('dlgSeguro').show()"
                                                 styleClass="ui-button-success">
                                    <p:resetInput target=":dialogoSeguro" />
                                </p:commandButton>
                            </p:toolbarGroup>
                        </p:toolbar>

                        <p:dataTable id="tblSeguros" value="#{seguroBean.list}" var="s"
                                     paginator="true" rows="10" size="small" paginatorPosition="bottom"
                                     rowKey="#{s.id}" selectionMode="single" selection="#{seguroBean.selected}"
                                     striped="true" rowStyleClass="#{s.estado ? null : 'fila-desactivada'}">

                            <p:column headerText="Código" width="100">
                                <h:outputText value="#{s.codigoAseguradora}" />
                            </p:column>

                            <p:column headerText="Aseguradora" sortBy="#{s.nombreAseguradora}">
                                <h:outputText value="#{s.nombreAseguradora}" />
                            </p:column>

                            <p:column headerText="Cobertura/Desc." width="110" style="text-align: center;">
                                <h:outputText value="#{s.porcentajeDescuento}%" />
                            </p:column>

                            <p:column headerText="Deducible" width="100" style="text-align: right;">
                                <h:outputText value="#{s.deducible}">
                                    <f:convertNumber type="currency" currencySymbol="Q" />
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Vigencia" width="180" style="text-align: center;">
                                <h:outputText value="#{s.fechaInicio}"><f:convertDateTime pattern="dd/MM/yy"/></h:outputText>
                                <h:outputText value=" - " />
                                <h:outputText value="#{s.fechaFinal}"><f:convertDateTime pattern="dd/MM/yy"/></h:outputText>
                            </p:column>

                            <p:column headerText="Estado" width="90" style="text-align: center;">
                                <p:tag severity="#{s.estado ? 'success' : 'danger'}" value="#{s.estado ? 'Activo' : 'Inactivo'}"/>
                            </p:column>

                            <p:column headerText="Acciones" width="120" style="text-align: center;">
                                <p:commandButton icon="pi pi-pencil"
                                                 action="#{seguroBean.edit(s)}"
                                                 update=":dialogoSeguro"
                                                 oncomplete="PF('dlgSeguro').show()"
                                                 styleClass="rounded-button ui-button-flat ui-button-warning"
                                                 disabled="#{!s.estado}">
                                    <p:resetInput target=":dialogoSeguro" />
                                </p:commandButton>

                                <p:commandButton icon="pi pi-ban" rendered="#{s.estado}"
                                                 action="#{seguroBean.delete(s)}"
                                                 update=":tabViewGeneral:frmSeguros:tblSeguros, :tabViewGeneral:frmSeguros:msgSeguros"
                                                 styleClass="rounded-button ui-button-flat ui-button-danger">
                                    <p:confirm header="Confirmar" message="¿Desactivar aseguradora?" icon="pi pi-exclamation-triangle" />
                                </p:commandButton>

                                <p:commandButton icon="pi pi-check-circle" rendered="#{!s.estado}"
                                                 action="#{seguroBean.activar(s)}"
                                                 update=":tabViewGeneral:frmSeguros:tblSeguros, :tabViewGeneral:frmSeguros:msgSeguros"
                                                 styleClass="rounded-button ui-button-flat ui-button-success" />
                            </p:column>
                        </p:dataTable>
                    </h:form>
                </p:tab>
            </p:tabView>
        </div>

        <h:form>
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="300">
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-flat"/>
                <p:commandButton value="Sí" type="button" styleClass="ui-confirmdialog-yes" />
            </p:confirmDialog>
        </h:form>

        <p:dialog id="dialogoDescuento" header="Datos de Promoción" showEffect="fade" modal="true"
                  widgetVar="dlgDescuento" responsive="true" width="500" closeOnEscape="true">
            <h:form>
                <div class="ui-fluid">
                    <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank ui-fluid">

                        <p:outputLabel value="Nombre Promoción:" for="nomD" styleClass="field-label"/>
                        <p:inputText id="nomD" value="#{descuentoBean.selected.nombrePromocion}" required="true"/>

                        <p:outputLabel value="Porcentaje (%):" for="porcD" styleClass="field-label"/>
                        <p:inputNumber id="porcD" value="#{descuentoBean.selected.descuentoPromocion}"
                                       symbol="%" symbolPosition="s" decimalPlaces="1" required="true"/>

                        <p:outputLabel value="Descripción / Detalles:" for="descD" styleClass="field-label"/>
                        <p:inputTextarea id="descD" value="#{descuentoBean.selected.descripcionPromocion}" rows="3"/>
                    </p:panelGrid>

                    <p:separator />
                    <div style="text-align: right;">
                        <p:commandButton value="Guardar" icon="pi pi-check"
                                         action="#{descuentoBean.save}"
                                         update=":tabViewGeneral:frmDescuentos:tblDescuentos, :tabViewGeneral:frmDescuentos:msgDescuentos"
                                         oncomplete="if(!args.validationFailed){PF('dlgDescuento').hide()}"/>
                    </div>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog id="dialogoSeguro" header="Datos de Aseguradora" showEffect="fade" modal="true"
                  widgetVar="dlgSeguro" responsive="true" width="600" closeOnEscape="true">
            <h:form>
                <div class="ui-fluid">
                    <p:panelGrid columns="2" columnClasses="ui-grid-col-4 field-label, ui-grid-col-8"
                                 layout="grid" styleClass="ui-panelgrid-blank ui-fluid">

                        <p:outputLabel value="Código:" for="codS"/>
                        <p:inputText id="codS" value="#{seguroBean.selected.codigoAseguradora}" required="true"/>

                        <p:outputLabel value="Nombre Aseguradora:" for="nomS"/>
                        <p:inputText id="nomS" value="#{seguroBean.selected.nombreAseguradora}" required="true"/>

                        <p:outputLabel value="Porcentaje Cobertura:" for="porcS"/>
                        <p:inputNumber id="porcS" value="#{seguroBean.selected.porcentajeDescuento}"
                                       symbol="%" symbolPosition="s" required="true"/>

                        <p:outputLabel value="Deducible:" for="dedS"/>
                        <p:inputNumber id="dedS" value="#{seguroBean.selected.deducible}"
                                       symbol="Q " symbolPosition="p" decimalPlaces="2"/>

                        <p:outputLabel value="Fecha Inicio:" for="fecI"/>
                        <p:datePicker id="fecI" value="#{seguroBean.selected.fechaInicio}" pattern="dd/MM/yyyy" showIcon="false"/>

                        <p:outputLabel value="Fecha Final:" for="fecF"/>
                        <p:datePicker id="fecF" value="#{seguroBean.selected.fechaFinal}" pattern="dd/MM/yyyy" showIcon="false"/>
                    </p:panelGrid>

                    <p:separator />
                    <div style="text-align: right;">
                        <p:commandButton value="Guardar" icon="pi pi-check"
                                         action="#{seguroBean.save}"
                                         update=":tabViewGeneral:frmSeguros:tblSeguros, :tabViewGeneral:frmSeguros:msgSeguros"
                                         oncomplete="if(!args.validationFailed){PF('dlgSeguro').hide()}"/>
                    </div>
                </div>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>