<ui:composition template="/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:define name="content">
        <h1>Gestión de Usuarios</h1>

        <!-- Formulario de usuario -->
        <h:form citaId="frmUsers">
            <p:growl citaId="msgUser" showDetail="true" life="4000" />

            <h:panelGrid columns="2" columnClasses="label,value">
                <h:outputLabel value="Nombre:" for="nombreUsuario"/>
                <p:inputText citaId="nombreUsuario" value="#{usuarioBean.selected.nombreUsuario}" required="true"/>

                <h:outputLabel value="Apellido:" for="apellidoUsuario"/>
                <p:inputText citaId="apellidoUsuario" value="#{usuarioBean.selected.apellidoUsuario}" required="true"/>

                <h:outputLabel value="Email:" for="email"/>
                <p:inputText citaId="email" value="#{usuarioBean.selected.email}" required="true"/>

                <h:outputLabel value="Teléfono:" for="telefono"/>
                <p:inputText citaId="telefono" value="#{usuarioBean.selected.telefono}"/>

                <h:outputLabel value="Contraseña:" for="password"/>
                <p:password citaId="password" value="#{usuarioBean.selected.password}" feedback="true"/>

                <h:outputLabel value="Rol:" for="role"/>
                <p:selectOneMenu citaId="role" value="#{usuarioBean.selected.role_name}">
                    <f:selectItems value="#{usuarioBean.roles}" var="r" itemLabel="#{r}" itemValue="#{r}"/>
                </p:selectOneMenu>


                <h:outputLabel value="Estado:" for="status"/>
                <p:selectBooleanCheckbox citaId="status" value="#{usuarioBean.selected.status}" />
            </h:panelGrid>

            <p:commandButton value="Guardar"
                             action="#{usuarioBean.save}"
                             update="tblUsers,frmUsers,msgUser"
                             icon="pi pi-check" />

            <p:commandButton value="Cancelar"
                             action="#{usuarioBean.newEntity}"
                             update="frmUsers,frmJornadas"
                             icon="pi pi-times"
                             styleClass="p-button-secondary" />

            <p:dataTable citaId="tblUsers"
                         value="#{usuarioBean.list}"
                         var="u"
                         paginator="true"
                         rows="10"
                         style="margin-top:20px;"
                         rowKey="#{u.citaId}"
                         selectionMode="single"
                         selection="#{usuarioBean.selected}">

                <p:column headerText="ID">
                    <h:outputText value="#{u.citaId}" />
                </p:column>

                <p:column headerText="Nombre">
                    <h:outputText value="#{u.nombreUsuario}" />
                </p:column>

                <p:column headerText="Apellido">
                    <h:outputText value="#{u.apellidoUsuario}" />
                </p:column>

                <p:column headerText="Email">
                    <h:outputText value="#{u.email}" />
                </p:column>

                <p:column headerText="Teléfono">
                    <h:outputText value="#{u.telefono}" />
                </p:column>

                <p:column headerText="Rol">
                    <h:outputText value="#{u.role.name}" />
                </p:column>

                <p:column headerText="Estado">
                    <h:outputText value="#{u.status ? 'Activo' : 'Inactivo'}" />
                </p:column>

                <p:column headerText="Acciones">
                    <p:commandButton value="Editar"
                                     action="#{usuarioBean.edit(u)}"
                                     actionListener="#{jornadaLaboralBean.setUserContext(usuarioBean.selected)}"
                                     update="frmUsers,frmJornadas"
                                     icon="pi pi-pencil" />

                    <p:commandButton value="Eliminar"
                                     action="#{usuarioBean.delete(u)}"
                                     update="tblUsers,frmJornadas"
                                     icon="pi pi-trash"
                                     styleClass="ui-button-danger" />
                </p:column>
            </p:dataTable>
        </h:form>

        <!-- Subformulario de jornadas laborales -->
        <h:form citaId="frmJornadas" style="margin-top:30px;">
            <p:growl citaId="msgJornadas" showDetail="true" life="4000" />

            <h3>Jornadas laborales del usuario seleccionado</h3>

            <h:panelGrid columns="2" columnClasses="label,value">
                <h:outputLabel value="Día:" for="dia"/>
                <p:selectOneMenu citaId="dia" value="#{jornadaLaboralBean.selected.dia_semana}">
                    <f:selectItems value="#{jornadaLaboralBean.diasSemana}" var="d" itemLabel="#{d}" itemValue="#{d}"/>
                </p:selectOneMenu>

                <h:outputLabel value="Hora inicio:" for="horaInicio"/>
                <p:datePicker citaId="horaInicio" value="#{jornadaLaboralBean.selected.horaInicio}" timeOnly="true"/>

                <h:outputLabel value="Hora fin:" for="horaFin"/>
                <p:datePicker citaId="horaFin" value="#{jornadaLaboralBean.selected.horaFin}" timeOnly="true"/>
            </h:panelGrid>

            <p:commandButton value="Guardar jornada"
                             action="#{jornadaLaboralBean.save}"
                             update="tblJornadas,frmJornadas,msgJornadas"
                             icon="pi pi-check" />

            <p:commandButton value="Cancelar"
                             action="#{jornadaLaboralBean.newEntity}"
                             update="frmJornadas"
                             icon="pi pi-times"
                             styleClass="p-button-secondary" />

            <p:dataTable citaId="tblJornadas"
                         value="#{jornadaLaboralBean.list}"
                         var="j"
                         paginator="true"
                         rows="7"
                         style="margin-top:20px;"
                         rowKey="#{j.citaId}"
                         selectionMode="single"
                         selection="#{jornadaLaboralBean.selected}">

                <p:column headerText="ID">
                    <h:outputText value="#{j.citaId}" />
                </p:column>

                <p:column headerText="Día">
                    <h:outputText value="#{j.dia_semana}" />
                </p:column>

                <p:column headerText="Hora inicio">
                    <h:outputText value="#{j.horaInicio}" />
                </p:column>

                <p:column headerText="Hora fin">
                    <h:outputText value="#{j.horaFin}" />
                </p:column>

                <p:column headerText="Acciones">
                    <p:commandButton value="Editar"
                                     action="#{jornadaLaboralBean.edit(j)}"
                                     update="frmJornadas"
                                     icon="pi pi-pencil" />

                    <p:commandButton value="Eliminar"
                                     action="#{jornadaLaboralBean.delete(j)}"
                                     update="tblJornadas"
                                     icon="pi pi-trash"
                                     styleClass="ui-button-danger" />
                </p:column>
            </p:dataTable>
        </h:form>
    </ui:define>
</ui:composition>

