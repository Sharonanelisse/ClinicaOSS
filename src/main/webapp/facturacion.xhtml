<ui:composition template="/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:define name="content">
        <h1>Gestión de Facturación</h1>

        <h:form citaId="frmFacturacion">
            <p:growl citaId="msgFacturacion" showDetail="true" life="4000" />

            <!-- Formulario de facturación -->
            <h:panelGrid columns="2" columnClasses="label,value">
                <h:outputLabel value="Fecha de emisión:" for="fechaEmision"/>
                <p:datePicker citaId="fechaEmision" value="#{facturacionBean.selected.fechaEmision}"
                              showTime="true" pattern="yyyy-MM-dd HH:mm"/>

                <h:outputLabel value="Subtotal:" for="subtotal"/>
                <p:inputText citaId="subtotal" value="#{facturacionBean.selected.subtotal}" />

                <h:outputLabel value="Total:" for="total"/>
                <p:inputText citaId="total" value="#{facturacionBean.selected.total}" />

                <h:outputLabel value="Estado de pago:" for="estadoPago"/>
                <p:selectOneMenu citaId="estadoPago" value="#{facturacionBean.selected.estado_pago}">
                    <f:selectItems value="#{facturacionBean.estadosPago}" var="ep"
                                   itemLabel="#{ep}" itemValue="#{ep}"/>
                </p:selectOneMenu>

                <h:outputLabel value="Tratamiento:" for="tratamiento"/>
                <p:selectOneMenu citaId="tratamiento" value="#{facturacionBean.selected.tratamiento}">
                    <f:selectItems value="#{facturacionBean.tratamientos}" var="t"
                                   itemLabel="#{t.nombreTratamiento}" itemValue="#{t}"/>
                </p:selectOneMenu>

                <h:outputLabel value="Paciente:" for="pacienteId"/>
                <p:selectOneMenu citaId="pacienteId" value="#{facturacionBean.selected.pacienteId}">
                    <f:selectItems value="#{facturacionBean.pacientes}" var="p"
                                   itemLabel="#{p.nombrePaciente}" itemValue="#{p}"/>
                </p:selectOneMenu>

                <h:outputLabel value="Cita:" for="citaId"/>
                <p:selectOneMenu citaId="citaId" value="#{facturacionBean.selected.citaId}">
                    <f:selectItems value="#{facturacionBean.citas}" var="c"
                                   itemLabel="#{c.codigo}" itemValue="#{c}"/>
                </p:selectOneMenu>

                <h:outputLabel value="Descuento:" for="descuentoId"/>
                <p:selectOneMenu citaId="descuentoId" value="#{facturacionBean.selected.descuentoId}">
                    <f:selectItems value="#{facturacionBean.descuentos}" var="d"
                                   itemLabel="#{d.nombre}" itemValue="#{d}"/>
                </p:selectOneMenu>

                <h:outputLabel value="Seguro:" for="seguro"/>
                <p:selectOneMenu citaId="seguro" value="#{facturacionBean.selected.seguro}">
                    <f:selectItems value="#{facturacionBean.seguros}" var="s"
                                   itemLabel="#{s.nombre}" itemValue="#{s}"/>
                </p:selectOneMenu>
            </h:panelGrid>

            <!-- Botones -->
            <p:commandButton value="Guardar"
                             action="#{facturacionBean.save}"
                             update="tblFacturacion,frmFacturacion,msgFacturacion"
                             icon="pi pi-check" />

            <p:commandButton value="Cancelar"
                             action="#{facturacionBean.newEntity}"
                             update="frmFacturacion"
                             icon="pi pi-times"
                             styleClass="p-button-secondary" />

            <!-- Tabla de facturación -->
            <p:dataTable citaId="tblFacturacion"
                         value="#{facturacionBean.list}"
                         var="f"
                         paginator="true"
                         rows="10"
                         style="margin-top:20px;"
                         rowKey="#{f.citaId}"
                         selectionMode="single"
                         selection="#{facturacionBean.selected}">

                <p:column headerText="ID">
                    <h:outputText value="#{f.citaId}" />
                </p:column>

                <p:column headerText="Fecha emisión">
                    <h:outputText value="#{f.fechaEmision}">
                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="Subtotal">
                    <h:outputText value="#{f.subtotal}" />
                </p:column>

                <p:column headerText="Total">
                    <h:outputText value="#{f.total}" />
                </p:column>

                <p:column headerText="Estado pago">
                    <h:outputText value="#{f.estado_pago}" />
                </p:column>

                <p:column headerText="Paciente">
                    <h:outputText value="#{f.pacienteId.nombrePaciente}" />
                </p:column>

                <p:column headerText="Tratamiento">
                    <h:outputText value="#{f.tratamiento.nombreTratamiento}" />
                </p:column>

                <p:column headerText="Cita">
                    <h:outputText value="#{f.citaId.codigo}" />
                </p:column>

                <p:column headerText="Descuento">
                    <h:outputText value="#{f.descuentoId.nombre}" />
                </p:column>

                <p:column headerText="Seguro">
                    <h:outputText value="#{f.seguro.nombre}" />
                </p:column>

                <p:column headerText="Acciones">
                    <p:commandButton value="Editar"
                                     action="#{facturacionBean.edit(f)}"
                                     update="frmFacturacion"
                                     icon="pi pi-pencil" />

                    <p:commandButton value="Eliminar"
                                     action="#{facturacionBean.delete(f)}"
                                     update="tblFacturacion"
                                     icon="pi pi-trash"
                                     styleClass="ui-button-danger" />
                </p:column>
            </p:dataTable>
        </h:form>
    </ui:define>
</ui:composition>
